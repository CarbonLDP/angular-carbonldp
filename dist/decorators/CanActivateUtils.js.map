{"version":3,"sources":["decorators/CanActivateUtils.ts"],"names":[],"mappings":"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","file":"decorators/CanActivateUtils.js","sourcesContent":["import {CanActivate} from \"angular2/src/router/lifecycle/lifecycle_annotations_impl\";\nimport {TypeDecorator, Class} from \"angular2/src/core/util/decorators\";\nimport {ComponentInstruction} from \"angular2/router\";\n\nimport {AbstractSecurityAnnotation} from \"./AbstractSecurityAnnotation\";\n\ninterface ChainableFn {\n\t( next:ComponentInstruction, previous:ComponentInstruction ):Promise<boolean> | boolean;\n\tevaluateFunctions?:Array<( next:ComponentInstruction, previous:ComponentInstruction ) => Promise<boolean> | boolean>;\n}\n\nclass ChainableCanActivateDecorator extends CanActivate {\n\tpublic fn:ChainableFn;\n\n\tconstructor() {\n\t\tlet fn:ChainableFn = ( next:ComponentInstruction, previous:ComponentInstruction ):Promise<boolean> | boolean => {\n\t\t\tlet promises:Promise<boolean>[] = [];\n\t\t\tfor( let evaluateFunction of fn.evaluateFunctions ) {\n\t\t\t\tlet result:Promise<boolean> | boolean = evaluateFunction( next, previous );\n\t\t\t\tif( typeof result === \"boolean\" ) {\n\t\t\t\t\tpromises.push( Promise.resolve( result ) );\n\t\t\t\t} else {\n\t\t\t\t\tpromises.push( result );\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn Promise.all( promises ).then( ( results:boolean[] ) => {\n\t\t\t\treturn results.reduce( ( previousValue, current ) => previousValue && current, true );\n\t\t\t});\n\t\t};\n\t\tfn.evaluateFunctions = [];\n\t\tsuper( fn );\n\t}\n}\n\nexport function makeCanActivateChainableDecorator( annotationCls:{ new( ...args:any[] ):AbstractSecurityAnnotation } ):( ...args:any[] ) => ( cls:any ) => any {\n\tfunction DecoratorFactory( objOrType:any ):( cls: any ) => any {\n\t\tlet annotationInstance:AbstractSecurityAnnotation = new annotationCls( objOrType );\n\n\t\tif (this instanceof annotationCls) {\n\t\t\treturn <any> annotationInstance;\n\t\t} else {\n\t\t\tlet chainAnnotation:any[] = typeof this === \"undefined\" && this.annotations instanceof Array ? this.annotations : [];\n\t\t\tchainAnnotation.push(annotationInstance);\n\n\t\t\tlet typeDecorator:TypeDecorator = <TypeDecorator>function TypeDecorator( cls:any ):any {\n\t\t\t\tlet annotations:any[] = Reflect.getOwnMetadata( \"annotations\", cls );\n\t\t\t\tannotations = annotations || [];\n\n\t\t\t\tlet chainableCanActivateAnnotation:ChainableCanActivateDecorator = annotations.find( ( annotation ) => annotation instanceof ChainableCanActivateDecorator );\n\t\t\t\tif( typeof chainableCanActivateAnnotation === \"undefined\" ) {\n\t\t\t\t\tchainableCanActivateAnnotation = new ChainableCanActivateDecorator();\n\t\t\t\t\tannotations.push( chainableCanActivateAnnotation );\n\t\t\t\t}\n\n\t\t\t\tchainableCanActivateAnnotation.fn.evaluateFunctions.push( annotationInstance.evaluate );\n\n\t\t\t\tReflect.defineMetadata( \"annotations\", annotations, cls );\n\t\t\t\treturn cls;\n\t\t\t};\n\n\t\t\ttypeDecorator.annotations = chainAnnotation;\n\t\t\ttypeDecorator.Class = Class;\n\n\t\t\treturn typeDecorator;\n\t\t}\n\t}\n\tDecoratorFactory.prototype = Object.create( annotationCls.prototype );\n\treturn DecoratorFactory;\n}\n"],"sourceRoot":"/source/"}